日志的格式是[XChecksum][Log1][Log2]...[Logn][BadTail]

其中, XChecksum是一个4字节的整数, 是后续所有日志的校验和, Log1到Logn是常规的日志数据, BadTail是在数据库崩溃时还没来得及写完的日志数据, 这个BadTail不一定存在

每条日志的结构是: [Size][checksum][Data], 其中Size是一个四字节整数, 标识了Data的字节数, checksum是这一条日志的校验和, 单条日志的校验和通过设定的一个SEED进行计算的

Logger被设置为迭代器模式, 通过next()方法不断地从文件读取下一条日志, 并将其中的Data解析出来并返回, next()的实现主要是靠internNext()方法

打开一个日志文件的时候, 需要首先校验日志文件的XChecksum, 并移除尾部的BadTail

GoDB的恢复策略来源于NYADB2的恢复策略

1. 对于单线程的情况来说, 事务之间永远不会相交, 所以恢复数据只需要正序执行一遍日志记录的操作, 撤销操作也只需要倒序执行日志记录的操作
2. 对于多线程的情况来说, 事务之间可能会有交集, 这会导致两种情况, 一是级联的回滚, 所以需要保证正在进行的事务, 不会读取到其它任何未提交的事务产生的数据; 二是无论怎样调整顺序都会恢复为错误的数据, 因为日志的结构过于简单, 不能覆盖所有数据库操作形成的语义, 所以需要保证正在进行的事务, 不会修改其它任何未提交的事务修改或产生的数据

有了以上的规定, 并发情况下的恢复操作就只需要重做崩溃时已完成的操作, 然后撤销所有崩溃时未完成的操作

    